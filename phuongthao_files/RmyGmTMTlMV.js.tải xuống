;/*FB_PKG_DELIM*/

__d("ChannelDefaults",[],(function(a,b,c,d,e,f){e.exports={LONGPOLL_TIMEOUT:6e4,STALL_THRESHOLD:18e4,MIN_RETRY_INTERVAL:5e3,MAX_RETRY_INTERVAL:3e4}}),null);
__d("ChannelStateMap",[],(function(a,b,c,d,e,f){e.exports={pull:{ok:"pull!",error:"pull",error_missing:"pull",error_msg_type:"pull",clock_anomaly:"pull!",visible:"pull!",hidden:"idle!",refresh_0:"reconnect",refresh_110:"reconnect!",refresh_111:"reconnect",refresh_112:"pull",refresh_113:"pull",refresh_117:"reconnect"},reconnect:{ok:"pull!",error:"reconnect",clock_anomaly:"reconnect!",visible:"pull!",hidden:"idle!"},idle:{ok:"idle!",clock_anomaly:"idle!",visible:"pull!",hidden:"idle!"},shutdown:{clock_anomaly:"shutdown!",visible:"shutdown!",hidden:"shutdown!"}}}),null);
__d("InstantGamesPresenceProperties",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1=!1}var b=a.prototype;b.addInstantGamePresence=function(){this.$1=!0};b.removeInstantGamePresence=function(){this.$1=!1};b.isActiveGamePresence=function(){return this.$1};return a}();b=new a();c=b;f["default"]=c}),66);
__d("MChatProxyConnectionState",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.auxiliaryIrisQueues={},this.aiq=null}var b=a.prototype;b.subscribeIrisQueue=function(a,b){this.auxiliaryIrisQueues[a]=b,this.updateCaches()};b.unsubscribeIrisQueue=function(a){delete this.auxiliaryIrisQueues[a],this.updateCaches()};b.updateCaches=function(){var a=[];for(var b in this.auxiliaryIrisQueues)Object.prototype.hasOwnProperty.call(this.auxiliaryIrisQueues,b)&&(a.push(b),a.push(this.auxiliaryIrisQueues[b]));a.length===0?this.aiq=null:this.aiq=a.join(",")};return a}();f["default"]=a}),66);
__d("MsgrPresenceUpdateFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("2511");b=d("FalcoLoggerInternal").create("msgr_presence_update",a);e=b;g["default"]=e}),98);
__d("MessengerMQTTPresenceReporting",["FBMqttChannel","InstantGamesPresenceProperties","MercuryConfig","MsgrPresenceUpdateFalcoEvent","ODS","gkx","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i="mqtt_web.presence",j="/foreground_state",k="/set_client_settings",l="/send_endpoint_capabilities",m=16384,n=2097152,o=c("MercuryConfig").idle_limit||18e5,p=c("MercuryConfig").idle_poll_interval||3e5,q=60*1e3,r=c("gkx")("21096")?!1:document.hasFocus(),s,t=Date.now(),u=!1,v=c("gkx")("21097");function a(){}function w(a,b){if(r!==a||b){r=a;var e=c("uuidv4")();c("FBMqttChannel").setForegroundState(a);c("FBMqttChannel").publish(j,JSON.stringify({foreground:a,client_request_id:e}));v&&c("MsgrPresenceUpdateFalcoEvent").log(function(){return{event_type:"app_state_update",is_foregrounded:a,client_request_id:e,is_new_ls_presence_reporting:!1}});(h||(h=d("ODS"))).bumpEntityKey(2966,i,a?"report.foregrounded":"report.backgrounded")}}function b(a){if(s===void 0||s!==a){var b=c("uuidv4")();s=a;c("FBMqttChannel").setChatVisibility(a);c("FBMqttChannel").publish(k,JSON.stringify({make_user_available_when_in_foreground:a,client_request_id:b}));v&&c("MsgrPresenceUpdateFalcoEvent").log(function(){return{event_type:"setting_update",is_presence_enabled:a,client_request_id:b,is_new_ls_presence_reporting:!1}});(h||(h=d("ODS"))).bumpEntityKey(2966,i,a?"report.chat_visibility.on":"report.chat_visibility.off")}}function e(){var a=c("FBMqttChannel").getEndpointCapabilities();a|=m;c("FBMqttChannel").setEndpointCapabilities(a);c("FBMqttChannel").publish(l,JSON.stringify({endpoint_capabilities:a}))}function x(a){var b=c("FBMqttChannel").getEndpointCapabilities();a?b|=n:b&=~n;c("FBMqttChannel").setEndpointCapabilities(b);c("FBMqttChannel").publish(l,JSON.stringify({endpoint_capabilities:b}))}function f(){t=Date.now(),w(!0,!1)}window.setInterval(function(){!document.hasFocus()&&Date.now()-t>o&&w(!1,!0)},p);window.setInterval(function(){var a=c("InstantGamesPresenceProperties").isActiveGamePresence();u!==a&&(x(a),u=a)},q);g.init=a;g.reportForegroundState=w;g.reportChatVisibility=b;g.reportWorkchatDesktopCapability=e;g.reportInstantGamesPresence=x;g.onUserActivity=f}),98);
__d("MessengerMQTTMobilePresenceActivity",["MEvent","MessengerMQTTPresenceReporting","Run"],(function(a,b,c,d,e,f,g){function a(){var a,b;(b=c("MEvent")).listen(window,"focus",(a=d("MessengerMQTTPresenceReporting")).onUserActivity);b.listen(window,"mousemove",a.onUserActivity);b.listen(window,"mousedown",a.onUserActivity);b.listen(window,"keypress",a.onUserActivity);b.listen(window,"touchmove",a.onUserActivity);b.listen(window,"blur",function(){d("MessengerMQTTPresenceReporting").reportForegroundState(!1,!1)});d("Run").onUnload(function(){d("MessengerMQTTPresenceReporting").reportForegroundState(!1,!0)})}g.init=a}),98);
__d("StateMachine",["EventEmitter","err","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){var g=0,h=function(){"use strict";function a(a,b){this.idx=g++,this.machine=a,this.asap=b&&b.substr(-1)=="!",this.name=this.asap?b.substr(0,b.length-1):b,this.progress=j.NEW,this.status=null}var b=a.prototype;b.enter=function(){this.machine.enter_private(this)};b.exit=function(a){this.machine.exit_private(this,a)};b.toString=function(){return this.name+"("+this.progress+","+this.status+")"};return a}(),i="_ABORT_",j=function(c){"use strict";babelHelpers.inheritsLoose(a,c);function a(a,b){var d;d=c.call(this)||this;d.$StateMachine1=a;d.$StateMachine2=b;d.$StateMachine3=0;d.$StateMachine4=[];d.$StateMachine5=Date.now();return d}var d=a.prototype;d.$StateMachine6=function(a){this.$StateMachine4.push(Date.now()-this.$StateMachine5+": "+a),this.$StateMachine4.length>40&&(this.$StateMachine4=this.$StateMachine4.splice(-20))};d.getState=function(){return this.$StateMachine7};d.setDelay=function(a){this.$StateMachine3=a||0;return this};d.getDelay=function(){return this.$StateMachine3};d.enter=function(a){this.enter_private(new h(this,a))};d.enter_private=function(c){this.$StateMachine6("enter "+c+", "+this.$StateMachine7),this.$StateMachine7&&this.$StateMachine7!=c&&this.$StateMachine7.exit(i),this.$StateMachine7=c,c.asap?(delete c.asap,this.$StateMachine2.enter&&this.$StateMachine2.enter(c),c.progress=a.ENTERED):(c.progress=a.PENDING,c.asap=!0,c.$StateMachine8=b("setTimeoutAcrossTransitions")(function(){c.enter()},this.$StateMachine3)),this.emit(a.ENTER,c)};d.exit=function(a){this.exit_private(this.$StateMachine7,a)};d.exit_private=function(c,d){this.$StateMachine6("exit "+c+", "+d+", "+this.$StateMachine7);(!c||c!=this.$StateMachine7)&&b("err")("Invalid state: %s, history: %s",c,this.$StateMachine4.join("|"));if(c.progress==a.EXITED)return;c.status=d;c.progress=a.EXITED;c.$StateMachine8&&(clearInterval(c.$StateMachine8),c.$StateMachine8=null);this.$StateMachine7=null;c&&this.$StateMachine2.exit&&this.$StateMachine2.exit(c);c.exited=!0;this.emit(a.EXIT,c);if(d!=i){var e=this.$StateMachine1[c.name];if(!e||!e[d])throw b("err")("No exit for state:%s, status: %s",c.name,d);this.enter(e[d])}};return a}(b("EventEmitter"));j.ENTER="enter";j.EXIT="exit";j.NEW="new";j.PENDING="pending";j.ENTERED="entered";j.EXITED="exited";e.exports=j}),null);
__d("MChannelManager",["ChannelClientConfig","ChannelClientID","ChannelDefaults","ChannelStateMap","Clock","FBMqttChannel","MChatProxyConnectionState","MobileWebMessageTypesSitevarConfig","ODS","StateMachine","Visibility"],(function(a,b,c,d,e,f){var g,h,i=null,j=null,k=null;f=null;b("ChannelClientID").getID();var l={enter:function(a){(g||(g=b("ODS"))).bumpEntityKey(2231,"ChannelManager","stateDelegate.enter.m.cleanup");return},exit:function(a){(g||(g=b("ODS"))).bumpEntityKey(2231,"ChannelManager","stateDelegate.exit.m.cleanup");if(a.status==="ok")a.name==="pull"&&h.setDelay(0);else if(!(a.status==null)){a=h.getDelay();a=a>0?a*2:i.MIN_RETRY_INTERVAL;a=Math.min(a,i.MAX_RETRY_INTERVAL);h.setDelay(a)}k&&(k.abort(),k=null)}};function m(){(g||(g=b("ODS"))).bumpEntityKey(2231,"ChannelManager","_mqttInit.m.cleanup"),b("FBMqttChannel").subscribe("/legacy_web_mtouch",function(a){try{a=JSON.parse(a);o(a)}catch(a){(g||(g=b("ODS"))).bumpEntityKey(2966,"ChannelManager","mqttInit.m."+a.message)}}),d(["MessengerMQTTMobilePresenceActivity","MessengerMQTTPresenceReporting"],function(a,b){a.init(),j&&b.reportChatVisibility(j.chat_enabled)})}function c(a){(g||(g=b("ODS"))).bumpEntityKey(2231,"ChannelManager","setTransform.m.cleanup"),f=a}function n(a){(g||(g=b("ODS"))).bumpEntityKey(2231,"ChannelManager","_handlePrivacyChangedMessage.m.cleanup"),a.visibility!=null&&(j&&j.chat_enabled!==a.visibility&&(j.chat_enabled=a.visibility,d(["MessengerMQTTPresenceReporting"],function(a){a.reportChatVisibility(j.chat_enabled)})))}function o(a){(g||(g=b("ODS"))).bumpEntityKey(2231,"ChannelManager","_processMqttMessage.m.cleanup"),b("MobileWebMessageTypesSitevarConfig").ChatProxySupportedMessageTypes.get(a.type)===!0&&b("MobileWebMessageTypesSitevarConfig").MQTTMigrationExcludeMessageTypes.get(a.type)!==!0?(a.type==="privacy_changed"?n(a.data):h.emit(h.CHANNEL_MESSAGE,a),(g||(g=b("ODS"))).bumpEntityKey(2966,"ChannelManager","processMqttMessages.m."+a.type)):(g||(g=b("ODS"))).bumpEntityKey(2966,"ChannelManager","processMqttMessages.m.dropped."+a.type)}function p(){if(!h.xhrEnabled||i)return;i=Object.assign(b("ChannelDefaults"),b("ChannelClientConfig").config);j=b("ChannelClientConfig").info;j.state=new(b("MChatProxyConnectionState"))();j.seq;b("Clock").addListener(b("Clock").ANOMALY,function(){h.exit("clock_anomaly")});b("Visibility").addListener(b("Visibility").HIDDEN,function(){h.exit("hidden")});b("Visibility").addListener(b("Visibility").VISIBLE,function(){h.exit("visible")});a.onbeforeunload=function(){k&&k.abort()};"sticky_token"in j&&j.sticky_token;(g||(g=b("ODS"))).bumpEntityKey(2966,"ChannelManager","channelStart.m");r()}function q(a,c){(g||(g=b("ODS"))).bumpEntityKey(2231,"ChannelManager","subscribeIrisQueue.m.cleanup"),j.state.subscribeIrisQueue(a,c)}function r(){h.setDelay(i.MIN_RETRY_INTERVAL),h.enter(j.uri?"pull!":"reconnect!"),m()}h=new(b("StateMachine"))(b("ChannelStateMap"),l);h.startChannel=p;h.setTransform=c;h.xhrEnabled=!!a.XMLHttpRequest;h.CHANNEL_MESSAGE="channel_message";h.subscribeIrisQueue=q;e.exports=h}),null);
__d("MobileZeroRewriteURL",["BanzaiLogger","MChannelManager"],(function(a,b,c,d,e,f){var g=null,h=null;function a(a){if(!a)return;g=a.regex_matcher;h=a.regex_replacer;for(a=0;a<g.length;a++){var c=g[a];c.indexOf("^")===0&&(c=c.substr(1));c=new RegExp(c,"i");g[a]=c}b("MChannelManager").setTransform(i)}function i(a){if(!g)return a;j(a);return a}function j(a){if(!a)return;if(Array.isArray(a))for(var b=0;b<a.length;b++)k(a,b);else for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&k(a,b)}function k(a,c){var d=a[c],e=typeof d;e==="object"?j(d):e==="string"&&d.indexOf("<img")>=0&&(d=d.replace(/<img[^>]*>/gi,function(a){for(var c=0;c<g.length;c++){var d=g[c],e=h[c],f=a.replace(d,e);if(d.test(a)){b("BanzaiLogger").log("ZeroImgRewriteLoggerConfig",{matcher:d,replacer:e,rewrite_url:f,url:a});return f}}return a}),a[c]=d)}f.main=a}),null);